/******/ (function() { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./assets/js/admin/modules/pages/tools.js":
/*!************************************************!*\
  !*** ./assets/js/admin/modules/pages/tools.js ***!
  \************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
let ExportImport;
(function ($) {
  'use strict';

  ExportImport = {
    init() {
      // Use typeof checks to avoid ReferenceError when variables aren't localized
      const exportVars = typeof ctaExportImportVars !== 'undefined' ? ctaExportImportVars : null;
      const adminVars = typeof ctaAdminVars !== 'undefined' ? ctaAdminVars : null;
      this.ajaxUrl = exportVars && exportVars.ajaxUrl || adminVars && adminVars.ajaxUrl;
      this.nonce = exportVars && exportVars.nonce || adminVars && adminVars.nonce;
      this.i18n = exportVars && exportVars.i18n || {};
      this.$exportBtn = $('#cta-export-button');
      this.$exportBtnInline = $('#cta-export-button-inline');
      this.$viewBtn = $('#cta-view-data');
      this.$modal = $('#cta-tools-export-data-modal');
      this.$modalContent = $('#cta-export-json-preview');
      this.$modalDownloadBtn = $('#cta-modal-download-json');
      this.$modalCopyBtn = $('#cta-modal-copy-json');
      // Export options modal elements
      this.$exportOptionsModal = $('#cta-export-options-modal');
      this.$exportOptionsDownloadBtn = $('#cta-export-download-btn');
      // View data toggles
      this.$viewToggles = $('.cta-view-toggle');
      this.$importBtn = $('#cta-import-button');
      this.$fileInput = $('#cta-import-file');
      this.$fileInputWrapper = $('#cta-file-input-wrapper');
      this.$fileSelected = $('#cta-file-selected');
      this.$fileName = $('#cta-file-name');
      this.$fileSize = $('#cta-file-size');
      this.$fileRemove = $('#cta-file-remove');
      this.$preview = $('#cta-import-preview');
      this.$previewContent = $('#cta-preview-content');
      this.$importMode = $('#cta-import-mode');
      this.$importBackup = $('#cta-import-backup');
      this.$importActions = $('#cta-import-actions');
      this.lastExportJson = '';
      this.fullExportData = null; // Store full data for filtering
      this.bind();
    },
    bind() {
      const self = this;
      // Export button opens export options modal
      this.$exportBtn.on('click', () => self.openExportOptionsModal());
      if (this.$exportBtnInline.length) {
        this.$exportBtnInline.on('click', () => self.openExportOptionsModal());
      }
      // Keep analytics export paired with CTAs
      $(document).on('change', '#cta-export-analytics', function () {
        if ($(this).is(':checked')) {
          $('#cta-export-ctas').prop('checked', true);
        }
      });
      // Export options modal download button
      this.$exportOptionsDownloadBtn.on('click', () => self.exportWithOptions());
      this.$viewBtn.on('click', () => self.viewData());
      this.$fileInput.on('change', e => self.handleFileSelect(e));
      this.$fileRemove.on('click', () => self.removeFile());
      this.$importBtn.on('click', e => self.import(e));
      this.$modalDownloadBtn.on('click', () => self.downloadFilteredData());
      this.$modalCopyBtn.on('click', () => self.copyToClipboard());
      // View data toggles - use event delegation for reliability with modal content
      $(document).on('change', '.cta-view-toggle', () => self.updateViewDataDisplay());
      this.handleImportModeChange();
      this.bindResetDataModal();
      this.bindDemoDataModals();
    },
    openExportOptionsModal() {
      if (window.ctaModalAPI && typeof window.ctaModalAPI.open === 'function') {
        window.ctaModalAPI.open(this.$exportOptionsModal);
      } else {
        this.$exportOptionsModal.show();
      }
    },
    getExportOptions() {
      const options = {
        ctas: $('#cta-export-ctas').is(':checked'),
        settings: $('#cta-export-settings').is(':checked'),
        analytics: $('#cta-export-analytics').is(':checked'),
        notifications: $('#cta-export-notifications').is(':checked')
      };
      // Analytics depends on CTAs to preserve referential integrity
      if (options.analytics) {
        options.ctas = true;
        $('#cta-export-ctas').prop('checked', true);
      }
      return options;
    },
    getViewToggles() {
      return {
        ctas: $('#cta-view-toggle-ctas').is(':checked'),
        settings: $('#cta-view-toggle-settings').is(':checked'),
        analytics: $('#cta-view-toggle-analytics').is(':checked'),
        notifications: $('#cta-view-toggle-notifications').is(':checked')
      };
    },
    filterData(data, options) {
      if (!data) return data;
      const filtered = {};

      // Preserve only export metadata
      const metaKeys = ['plugin', 'version', 'db_version', 'exported', 'site_url', 'is_pro'];
      metaKeys.forEach(key => {
        if (data[key] !== undefined) {
          filtered[key] = data[key];
        }
      });

      // Add toggleable data based on options
      if (options.ctas && data.ctas !== undefined) {
        filtered.ctas = data.ctas;
        if (data.ab_tests !== undefined) filtered.ab_tests = data.ab_tests;
        if (data.ab_events !== undefined) filtered.ab_events = data.ab_events;
      }
      if (options.settings) {
        if (data.settings !== undefined) filtered.settings = data.settings;
        if (data.settings_table !== undefined) filtered.settings_table = data.settings_table;
        if (data.custom_icons !== undefined) filtered.custom_icons = data.custom_icons;
        if (data.onboarding !== undefined) filtered.onboarding = data.onboarding;
      }
      if (options.analytics && data.analytics !== undefined) filtered.analytics = data.analytics;
      if (options.notifications && data.notifications !== undefined) filtered.notifications = data.notifications;
      return filtered;
    },
    exportWithOptions() {
      if (!this.ajaxUrl || !this.nonce) return;
      const $btn = this.$exportOptionsDownloadBtn;
      const originalHtml = $btn.html();
      $btn.prop('disabled', true).html('<span class="dashicons dashicons-update spin"></span> ' + (this.i18n.exporting || 'Exporting...'));
      $.ajax({
        url: this.ajaxUrl,
        type: 'POST',
        dataType: 'json',
        data: {
          action: 'cta_export_settings',
          nonce: this.nonce
        },
        success: res => {
          if (res.success && res.data) {
            const options = this.getExportOptions();
            const filteredData = this.filterData(res.data, options);
            const jsonString = JSON.stringify(filteredData, null, 2);
            this.download(jsonString);
            // Close modal
            if (window.ctaModalAPI && typeof window.ctaModalAPI.close === 'function') {
              window.ctaModalAPI.close(this.$exportOptionsModal);
            } else {
              this.$exportOptionsModal.hide();
            }
            if (window.CTAToast) {
              CTAToast.success('Data exported successfully');
            }
          } else {
            if (window.CTAToast) {
              CTAToast.error(res.message || this.i18n.exportFailed || 'Export failed');
            } else {
              alert(res.message || this.i18n.exportFailed || 'Export failed');
            }
          }
        },
        error: () => {
          if (window.CTAToast) {
            CTAToast.error(this.i18n.exportFailed || 'Export failed');
          } else {
            alert(this.i18n.exportFailed || 'Export failed');
          }
        },
        complete: () => $btn.prop('disabled', false).html(originalHtml)
      });
    },
    updateViewDataDisplay() {
      if (!this.fullExportData) return;
      const options = this.getViewToggles();
      const filteredData = this.filterData(this.fullExportData, options);
      this.$modalContent.val(JSON.stringify(filteredData, null, 2));
    },
    downloadFilteredData() {
      if (!this.fullExportData) {
        this.download(this.$modalContent.val());
        return;
      }
      const options = this.getViewToggles();
      const filteredData = this.filterData(this.fullExportData, options);
      this.download(JSON.stringify(filteredData, null, 2));
    },
    copyToClipboard() {
      const jsonContent = this.$modalContent.val();
      if (!jsonContent) {
        if (window.CTAToast) {
          CTAToast.warning('No data to copy');
        }
        return;
      }
      navigator.clipboard.writeText(jsonContent).then(() => {
        if (window.CTAToast) {
          CTAToast.success(this.i18n.copied || 'Copied to clipboard');
        }
      }).catch(() => {
        // Fallback for older browsers
        this.$modalContent.select();
        document.execCommand('copy');
        if (window.CTAToast) {
          CTAToast.success(this.i18n.copied || 'Copied to clipboard');
        }
      });
    },
    formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    },
    handleFileSelect(e) {
      const file = e.target.files[0];
      if (!file) return;

      // Validate file type - must be JSON
      if (!file.name.endsWith('.json') && file.type !== 'application/json') {
        // Clear the file input
        this.$fileInput.val('');

        // Show error message
        if (window.CTAToast) {
          CTAToast.error(this.i18n.invalidFileType || 'Please select a valid JSON file');
        } else {
          alert(this.i18n.invalidFileType || 'Please select a valid JSON file');
        }

        // Hide file info and import actions
        this.$fileSelected.hide();
        this.$fileInputWrapper.show();
        this.$importActions.hide();
        this.$importBtn.prop('disabled', true);
        return;
      }

      // Show file info, hide upload button
      this.$fileName.text(file.name);
      this.$fileSize.text('(' + this.formatFileSize(file.size) + ')');
      this.$fileInputWrapper.hide();
      this.$fileSelected.show();

      // Show import actions and enable button
      this.$importActions.show();
      this.$importBtn.prop('disabled', false);

      // Also trigger the preview
      this.previewFile(e);
    },
    removeFile() {
      // Clear the file input
      this.$fileInput.val('');

      // Hide file info, show upload button
      this.$fileSelected.hide();
      this.$fileInputWrapper.show();

      // Hide import actions and disable button
      this.$importActions.hide();
      this.$importBtn.prop('disabled', true);

      // Hide preview
      this.$preview.hide();
      this.$previewContent.text('');
    },
    export() {
      if (!this.ajaxUrl || !this.nonce) return;
      const $btn = this.$exportBtn;
      const originalHtml = $btn.html();
      $btn.prop('disabled', true).html('<span class="dashicons dashicons-update spin"></span> ' + (this.i18n.exporting || 'Exporting...'));
      $.ajax({
        url: this.ajaxUrl,
        type: 'POST',
        dataType: 'json',
        data: {
          action: 'cta_export_settings',
          nonce: this.nonce
        },
        success: res => {
          if (res.success && res.data) {
            this.lastExportJson = JSON.stringify(res.data, null, 2);
            this.download(this.lastExportJson);
            if (window.CTAToast) {
              CTAToast.success('Settings exported successfully');
            }
          } else {
            if (window.CTAToast) {
              CTAToast.error(res.message || this.i18n.exportFailed || 'Export failed');
            } else {
              alert(res.message || this.i18n.exportFailed || 'Export failed');
            }
          }
        },
        error: () => {
          if (window.CTAToast) {
            CTAToast.error(this.i18n.exportFailed || 'Export failed');
          } else {
            alert(this.i18n.exportFailed || 'Export failed');
          }
        },
        complete: () => $btn.prop('disabled', false).html(originalHtml)
      });
    },
    download(jsonString) {
      if (!jsonString) return;
      const blob = new Blob([jsonString], {
        type: 'application/json'
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'cta-manager-export-' + Date.now() + '.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    },
    previewFile(e) {
      const file = e.target.files[0];
      if (!file || file.type !== 'application/json') return;
      const reader = new FileReader();
      reader.onload = evt => {
        try {
          const json = JSON.parse(evt.target.result);
          this.$previewContent.text(JSON.stringify(json, null, 2));
          this.$preview.show();
        } catch (err) {
          if (window.CTAToast) {
            CTAToast.error(this.i18n.invalidJson || 'Invalid JSON file');
          } else {
            alert(this.i18n.invalidJson || 'Invalid JSON file');
          }
        }
      };
      reader.readAsText(file);
    },
    import() {
      if (!this.ajaxUrl || !this.nonce) return;
      const file = this.$fileInput[0].files[0];
      if (!file) {
        if (window.CTAToast) {
          CTAToast.warning(this.i18n.chooseFile || 'Please choose a file');
        } else {
          alert(this.i18n.chooseFile || 'Please choose a file');
        }
        return;
      }
      const formData = new FormData();
      formData.append('action', 'cta_import_settings');
      formData.append('nonce', this.nonce);
      formData.append('file', file);
      formData.append('import[mode]', this.$importMode.val());
      formData.append('import[backup]', this.$importBackup.is(':checked') ? '1' : '0');
      const $btn = this.$importBtn;
      const originalHtml = $btn.html();
      $btn.prop('disabled', true).html('<span class="dashicons dashicons-update spin"></span> ' + (this.i18n.importing || 'Importing...'));
      $.ajax({
        url: this.ajaxUrl,
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: res => {
          if (res.success) {
            if (window.CTAToast) {
              CTAToast.success(res.message || this.i18n.imported || 'Import successful');
              setTimeout(() => location.reload(), 1500);
            } else {
              alert(res.message || this.i18n.imported || 'Import successful');
              location.reload();
            }
          } else {
            if (window.CTAToast) {
              CTAToast.error(res.message || this.i18n.importFailed || 'Import failed');
            } else {
              alert(res.message || this.i18n.importFailed || 'Import failed');
            }
          }
        },
        error: () => {
          if (window.CTAToast) {
            CTAToast.error(this.i18n.importFailed || 'Import failed');
          } else {
            alert(this.i18n.importFailed || 'Import failed');
          }
        },
        complete: () => $btn.prop('disabled', false).html(originalHtml)
      });
    },
    viewData() {
      const showModal = data => {
        // Store full data for filtering
        this.fullExportData = data;
        // Reset all toggles to checked
        this.$viewToggles.prop('checked', true);
        // Display full data
        const jsonString = JSON.stringify(data, null, 2);
        this.lastExportJson = jsonString;
        this.$modalContent.val(jsonString);
        if (window.ctaModalAPI && typeof window.ctaModalAPI.open === 'function') {
          window.ctaModalAPI.open(this.$modal);
        } else {
          this.$modal.fadeIn(150);
          $('body').addClass('cta-modal-open');
        }
      };
      if (!this.ajaxUrl || !this.nonce) return;
      const $btn = this.$viewBtn;
      const originalHtml = $btn.html();
      $btn.prop('disabled', true).html('<span class="dashicons dashicons-update spin"></span> Loading...');
      $.ajax({
        url: this.ajaxUrl,
        type: 'POST',
        dataType: 'json',
        data: {
          action: 'cta_export_settings',
          nonce: this.nonce
        },
        success: res => {
          if (res.success && res.data) {
            const data = typeof res.data === 'string' ? JSON.parse(res.data) : res.data;
            showModal(data);
          } else {
            if (window.CTAToast) {
              CTAToast.error(res.message || this.i18n.exportFailed || 'Export failed');
            } else {
              alert(res.message || this.i18n.exportFailed || 'Export failed');
            }
          }
        },
        error: () => {
          if (window.CTAToast) {
            CTAToast.error(this.i18n.exportFailed || 'Export failed');
          } else {
            alert(this.i18n.exportFailed || 'Export failed');
          }
        },
        complete: () => $btn.prop('disabled', false).html(originalHtml)
      });
    },
    handleImportModeChange() {
      const $select = this.$importMode;
      if (!$select.length) return;
      const $proBadge = $('#cta-import-mode-pro-badge');
      const $errorMsg = $('#cta-import-mode-pro-error');
      const isPro = $select.data('is-pro') === 1;
      $select.on('change', function () {
        const requiresPro = $(this).find('option:selected').data('requires-pro') === 1;
        if (requiresPro && !isPro) {
          $proBadge.fadeIn(200);
          $errorMsg.slideDown(200);
        } else {
          $proBadge.fadeOut(200);
          $errorMsg.slideUp(200);
        }
      });
      $select.trigger('change');
    },
    bindResetDataModal() {
      const self = this;
      const $openBtn = $('#cta-open-reset-modal');
      const $modal = $('#cta-reset-data-modal');
      const $form = $('#cta-reset-data-form');
      const $exportBtn = $('#cta-reset-export-first');
      const $confirmBtn = $('#cta-reset-confirm-button');
      if (!$openBtn.length || !$modal.length) return;
      $openBtn.on('click', function () {
        if (window.ctaModalAPI && typeof window.ctaModalAPI.open === 'function') {
          window.ctaModalAPI.open($modal);
        } else {
          $modal.fadeIn(200);
          $('body').addClass('cta-modal-open');
        }
      });

      // Export data from within modal
      $exportBtn.on('click', function () {
        const $btn = $(this);
        const originalHtml = $btn.html();
        $btn.prop('disabled', true).html('<span class="dashicons dashicons-update"></span> Exporting...');

        // Reuse export logic
        if (!self.ajaxUrl || !self.nonce) {
          $btn.prop('disabled', false).html(originalHtml);
          return;
        }
        $.ajax({
          url: self.ajaxUrl,
          type: 'POST',
          dataType: 'json',
          data: {
            action: 'cta_export_settings',
            nonce: self.nonce
          },
          success: res => {
            if (res.success && res.data) {
              const jsonString = JSON.stringify(res.data, null, 2);
              self.download(jsonString);
              if (window.CTAToast) {
                CTAToast.success('Data exported successfully');
              }
            } else {
              if (window.CTAToast) {
                CTAToast.error(res.message || 'Export failed');
              } else {
                alert(res.message || 'Export failed');
              }
            }
          },
          error: () => {
            if (window.CTAToast) {
              CTAToast.error('Export failed');
            } else {
              alert('Export failed');
            }
          },
          complete: () => {
            $btn.prop('disabled', false).html(originalHtml);
          }
        });
      });
      $confirmBtn.on('click', function (e) {
        e.preventDefault();

        // Get selected toggles
        const resetCtas = $('#cta-reset-ctas').is(':checked');
        const resetSettings = $('#cta-reset-settings').is(':checked');
        const resetAnalytics = $('#cta-reset-analytics').is(':checked');
        const resetNotifications = $('#cta-reset-notifications').is(':checked');

        // Validate at least one toggle is selected
        if (!resetCtas && !resetSettings && !resetAnalytics && !resetNotifications) {
          if (window.CTAToast) {
            CTAToast.warning('Please select at least one data type to reset.');
          } else {
            alert('Please select at least one data type to reset.');
          }
          return;
        }

        // Build confirmation message
        const selected = [];
        if (resetCtas) selected.push('CTAs');
        if (resetSettings) selected.push('Settings');
        if (resetAnalytics) selected.push('Analytics');
        if (resetNotifications) selected.push('Notifications');
        let message = 'Are you sure you want to permanently delete: ' + selected.join(', ') + '?\n\n';
        message += 'Demo data will NOT be affected. This action cannot be undone.';
        if (confirm(message)) {
          $form.submit();
        }
      });
    },
    /**
     * Bind Demo Data Modal handlers
     */
    bindDemoDataModals() {
      const self = this;
      const $deleteBtn = $('#cta-open-delete-demo-modal');
      const $deleteModal = $('#cta-delete-demo-modal');
      const $deleteForm = $('#cta-delete-demo-form');
      const $deleteConfirm = $('#cta-delete-demo-confirm');

      // Delete Demo Data Modal
      if ($deleteBtn.length && $deleteModal.length) {
        $deleteBtn.on('click', function () {
          if (window.ctaModalAPI && typeof window.ctaModalAPI.open === 'function') {
            window.ctaModalAPI.open($deleteModal);
          } else {
            $deleteModal.fadeIn(200);
            $('body').addClass('cta-modal-open');
          }
        });
        $deleteConfirm.on('click', function (e) {
          e.preventDefault();
          const scope = $deleteForm.find('input[name="delete_scope"]:checked').val();
          let message = 'Are you sure you want to delete ';
          if (scope === 'all') {
            message += 'all demo CTAs and analytics';
          } else if (scope === 'ctas') {
            message += 'all demo CTAs';
          } else {
            message += 'all demo analytics';
          }
          message += '? This cannot be undone.';
          if (confirm(message)) {
            $deleteForm.submit();
          }
        });
      }

      // Import Demo Data Modal - Selective Import with Toggles
      this.bindImportDemoModal();
    },
    /**
     * Bind Import Demo Modal with toggle state management and AJAX submission
     * Tasks 3.1-3.5: Modal open handler, toggle state management, submit handler,
     * validation feedback, and success response handler
     */
    bindImportDemoModal() {
      const self = this;
      const $importBtn = $('#cta-open-import-demo-modal');
      const $importModal = $('#cta-import-demo-modal');
      const $submitBtn = $('#cta-import-demo-submit');
      const $errorContainer = $importModal.find('.cta-import-error');

      // Toggle input selectors
      const $toggleSettings = $('#import-toggle-settings');
      const $toggleCtas = $('#import-toggle-ctas');
      const $toggleAnalytics = $('#import-toggle-analytics');
      const $toggleNotifications = $('#import-toggle-notifications');

      // Task 3.2: Toggle state management
      const importToggles = {
        settings: true,
        ctas: true,
        analytics: true,
        notifications: true
      };

      // Helper to reset toggles to default state (all enabled)
      const resetToggles = () => {
        importToggles.settings = true;
        importToggles.ctas = true;
        importToggles.analytics = true;
        importToggles.notifications = true;
        $toggleSettings.prop('checked', true);
        $toggleCtas.prop('checked', true);
        $toggleAnalytics.prop('checked', true);
        $toggleNotifications.prop('checked', true);

        // Hide any previous error
        $errorContainer.hide().text('');
      };

      // Bind toggle change events to update state
      $toggleSettings.on('change', function () {
        importToggles.settings = $(this).is(':checked');
      });
      $toggleCtas.on('change', function () {
        importToggles.ctas = $(this).is(':checked');
      });
      $toggleAnalytics.on('change', function () {
        importToggles.analytics = $(this).is(':checked');
      });
      $toggleNotifications.on('change', function () {
        importToggles.notifications = $(this).is(':checked');
      });

      // Task 3.1: Open modal handler
      if ($importBtn.length && $importModal.length) {
        $importBtn.on('click', function (e) {
          e.preventDefault();

          // Reset toggle states to default (all enabled)
          resetToggles();
          if (window.ctaModalAPI && typeof window.ctaModalAPI.open === 'function') {
            window.ctaModalAPI.open($importModal);
          } else {
            $importModal.fadeIn(200);
            $('body').addClass('cta-modal-open');
          }
        });
      }

      // Task 3.3: Import submit handler with AJAX
      if ($submitBtn.length) {
        $submitBtn.on('click', function (e) {
          e.preventDefault();

          // Task 3.4: Validation - ensure at least one toggle is enabled
          const hasSelection = importToggles.settings || importToggles.ctas || importToggles.analytics || importToggles.notifications;
          if (!hasSelection) {
            $errorContainer.text('Please select at least one data type to import.').show();
            return;
          }

          // Hide any previous error
          $errorContainer.hide().text('');

          // Show loading state on button
          const $btn = $(this);
          const originalHtml = $btn.html();
          $btn.prop('disabled', true).html('<span class="dashicons dashicons-update spin"></span> Importing...');

          // Send AJAX request
          $.ajax({
            url: self.ajaxUrl,
            type: 'POST',
            dataType: 'json',
            data: {
              action: 'cta_import_demo_data_selective',
              nonce: self.nonce,
              import_settings: importToggles.settings ? 1 : 0,
              import_ctas: importToggles.ctas ? 1 : 0,
              import_analytics: importToggles.analytics ? 1 : 0,
              import_notifications: importToggles.notifications ? 1 : 0
            },
            success: function (res) {
              if (res.success) {
                // Task 3.5: Success response handler
                const data = res.data || {};
                const counts = data.counts || {};

                // Build success message with import counts
                const parts = [];
                if (counts.settings !== undefined && counts.settings > 0) {
                  parts.push(counts.settings + ' settings');
                }
                if (counts.ctas !== undefined && counts.ctas > 0) {
                  parts.push(counts.ctas + ' CTAs');
                }
                if (counts.analytics !== undefined && counts.analytics > 0) {
                  parts.push(counts.analytics + ' analytics events');
                }
                if (counts.notifications !== undefined && counts.notifications > 0) {
                  parts.push(counts.notifications + ' notifications');
                }
                let successMessage = 'Import complete';
                if (parts.length > 0) {
                  successMessage += ': ' + parts.join(', ') + ' imported.';
                } else {
                  successMessage += '.';
                }

                // Close modal
                if (window.ctaModalAPI && typeof window.ctaModalAPI.close === 'function') {
                  window.ctaModalAPI.close($importModal);
                } else {
                  $importModal.fadeOut(200);
                  $('body').removeClass('cta-modal-open');
                }

                // Show success notification
                if (window.CTAToast) {
                  CTAToast.success(successMessage);
                } else {
                  alert(successMessage);
                }

                // Trigger custom event for onboarding modal to listen
                $(document).trigger('ctaDemoDataImported', [data]);

                // Only refresh page if not in onboarding context
                // Check if onboarding modal is visible
                var $onboardingModal = $('#cta-dashboard-help-modal');
                var isOnboarding = $onboardingModal.length && $onboardingModal.is(':visible');
                if (!isOnboarding) {
                  // Refresh page after short delay to show updated data
                  setTimeout(function () {
                    location.reload();
                  }, 1500);
                }
              } else {
                // Show error message in modal
                const errorMsg = res.data && res.data.message ? res.data.message : res.message || 'Import failed. Please try again.';
                $errorContainer.text(errorMsg).show();
              }
            },
            error: function (xhr, status, error) {
              // Show error message in modal
              $errorContainer.text('Import failed: ' + (error || 'Network error. Please try again.')).show();
            },
            complete: function () {
              // Restore button state
              $btn.prop('disabled', false).html(originalHtml);
            }
          });
        });
      }
    }
  };
  function showToast(message, type) {
    if (window.CTAToast && typeof window.CTAToast[type] === 'function') {
      window.CTAToast[type](message);
      return;
    }
    if (window.CTCAdmin && typeof window.CTCAdmin.showNotice === 'function') {
      window.CTCAdmin.showNotice(message, type === 'success' ? 'success' : 'error');
      return;
    }
    // Fallback: minimal toast renderer using CTA toast classes
    let $container = $('.cta-toast-container');
    if (!$container.length) {
      $container = $('<div class="cta-toast-container cta-toast-position-top-right"></div>');
      $('body').append($container);
    }
    const iconMap = {
      success: 'dashicons-yes-alt',
      error: 'dashicons-dismiss',
      warning: 'dashicons-warning',
      info: 'dashicons-info'
    };
    const icon = iconMap[type] || iconMap.info;
    const $toast = $('<div class="cta-toast cta-toast-' + type + '" role="alert" aria-live="polite">' + '<div class="cta-toast-icon"><span class="dashicons ' + icon + '"></span></div>' + '<div class="cta-toast-content"><div class="cta-toast-message">' + message + '</div></div>' + '<div class="cta-toast-progress"><div class="cta-toast-progress-bar"></div></div>' + '</div>');
    $container.append($toast);
    setTimeout(function () {
      $toast.addClass('cta-toast-show');
    }, 10);
    setTimeout(function () {
      $toast.removeClass('cta-toast-show').addClass('cta-toast-hide');
      setTimeout(function () {
        $toast.remove();
      }, 300);
    }, 4000);
  }
  $(function () {
    // Initialize if any of the tools page elements exist OR if the import demo modal exists (global)
    if ($('#cta-import-form').length || $('#cta-open-reset-modal').length || $('#cta-open-delete-demo-modal').length || $('#cta-open-import-demo-modal').length || $('#cta-import-demo-modal').length) {
      ExportImport.init();
    }
    const $debugToggle = $('#cta-debug-enabled');
    const $debugRow = $('#cta-debug-toggle');
    if ($debugToggle.length && $debugRow.length) {
      let requestInFlight = false;
      $debugToggle.on('change', function () {
        if (requestInFlight) return;
        const enabled = $debugToggle.is(':checked');
        const nonce = $debugRow.data('nonce');
        requestInFlight = true;
        $.ajax({
          url: window.ctaAdminVars && window.ctaAdminVars.ajaxUrl ? window.ctaAdminVars.ajaxUrl : ajaxurl,
          method: 'POST',
          dataType: 'json',
          data: {
            action: 'cta_toggle_debug',
            nonce: nonce,
            enabled: enabled ? '1' : '0'
          },
          success: function (res) {
            if (res && res.success) {
              showToast(res.data.enabled ? 'Debug mode enabled.' : 'Debug mode disabled.', 'success');
            } else {
              $debugToggle.prop('checked', !enabled);
              showToast('Unable to update debug mode. Please try again.', 'error');
            }
          },
          error: function () {
            $debugToggle.prop('checked', !enabled);
            showToast('Unable to update debug mode. Please try again.', 'error');
          },
          complete: function () {
            requestInFlight = false;
          }
        });
      });
    }
  });
})(jQuery);
// ES6 Export
/* harmony default export */ __webpack_exports__["default"] = (ExportImport);

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Check if module exists (development only)
/******/ 		if (__webpack_modules__[moduleId] === undefined) {
/******/ 			var e = new Error("Cannot find module '" + moduleId + "'");
/******/ 			e.code = 'MODULE_NOT_FOUND';
/******/ 			throw e;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	!function() {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = function(exports) {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	}();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry needs to be wrapped in an IIFE because it needs to be isolated against other modules in the chunk.
!function() {
/*!*********************************************!*\
  !*** ./assets/js/admin/components/tools.js ***!
  \*********************************************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _modules_pages_tools__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/pages/tools */ "./assets/js/admin/modules/pages/tools.js");
/**
 * CTA Manager - Tools Page Entry Point
 *
 * Entry point for the Tools page (cta-manager-tools).
 * Handles export/import, backup, demo data, and other utilities.
 *
 * When bundled with npm, this file will import:
 * - pages/tools (export/import functionality)
 *
 * Dependencies (loaded via admin.js):
 * - CTCAdmin, ctaModalAPI, CTAToast
 *
 * Output: /assets/js/minimized/admin/tools.js
 *
 * @package CTA_Manager
 * @since 1.0.0
 */

// ES6 Module Imports (uncomment when bundling with npm)

(function ($) {
  'use strict';

  /**
   * Tools Page Controller
   */
  window.CTAToolsPage = window.CTAToolsPage || {
    /**
     * Required modules for this page
     */
    modules: {
      tools: 'CTAExportImport'
    },
    /**
     * Initialize the Tools page
     */
    init: function () {
      // Wait for admin app to be ready
      $(document).on('ctaAdminReady', this.onAdminReady.bind(this));

      // If admin is already ready, initialize now
      if (window.CTAAdminApp) {
        this.onAdminReady();
      }
    },
    /**
     * Called when admin app is ready
     */
    onAdminReady: function () {
      // Tools module self-initializes via pages/tools.js

      // Trigger page ready event
      $(document).trigger('ctaToolsReady', [this]);
    }
  };

  // Initialize on document ready
  $(function () {
    window.CTAToolsPage.init();
  });
})(jQuery);
}();
/******/ })()
;